# Приветствую команду Selectel

Линтер для Go (Go 1.22+), совместимый с `golangci-lint`, который проверяет текст лог‑сообщений на соответствие правилам стиля и безопасности.

## Что проверяет

Линтер анализирует **только строковые литералы** в качестве сообщения (первый аргумент вызова), например:

- `slog.Info("starting server")`
- `logger.Info("starting server", ...)`

Если сообщение собирается динамически (`"token: " + token`, `fmt.Sprintf(...)` и т.п.) — линтер не пытается вычислять итоговую строку и пропускает такие вызовы.

Правила:

1. **Lowercase**: сообщение начинается со строчной буквы  
2. **English only**: сообщение не содержит кириллицу (проверка по Unicode ranges)  
3. **No special symbols / emoji**: сообщение не содержит спецсимволы/эмодзи (настраиваемый список запрещённых символов + детект эмодзи)  
4. **Sensitive data**: сообщение не содержит потенциально чувствительных ключевых слов/паттернов (настраиваемый список подстрок)

## Конфигурация

По умолчанию читается `.sloglint.yaml` из текущей директории. Можно указать путь вручную (для standalone‑запуска).

Пример `.sloglint.yaml`:

```yaml
rules:
  lowercase: true
  english_only: true
  no_special_symbols: true
  sensitive_data: true

sensitive_patterns:
  - password
  - pwd
  - token
  - api_key
  - secret

# символы, которые считаются запрещёнными в сообщении
forbidden_symbols: "!?:*"
```

## Авто‑исправления (SuggestedFixes)

Линтер умеет предлагать авто‑фиксы для части правил:

- **Lowercase**: делает первый символ сообщения строчным (если это буква).
- **No special symbols / emoji**: удаляет запрещённые символы и эмодзи из строкового литерала.

Для правил **English only** и **Sensitive data** авто‑правки не делаются, т.к. безопасно «угадать» корректную фразу обычно невозможно.

## Использование

### Как standalone‑линтер (go/analysis singlechecker)

```bash
go run ./cmd --config ./.sloglint.yaml ./...
```

### В составе golangci-lint

В репозитории есть пример конфигурации `.golangci.yml` с подключением кастомного линтера:

```yaml
linters:
  enable:
    - loglint

linters-settings:
  custom:
    loglint:
      path: ./cmd
```

Дальше запускайте обычный `golangci-lint run`.

Примечание: конфиг `.sloglint.yaml` читается из рабочей директории запуска `golangci-lint`.

## Тесты

```bash
go test ./...
```

Тестовые кейсы лежат в `testdata/` и запускаются через `analysistest`.

## Ограничения текущей реализации

- Анализируются только вызовы методов с именами `Info`, `Error`, `Warn`, `Debug` и только когда **первый аргумент — строковый литерал**.
- Линтер не делает data‑flow анализ и не пытается вычислять строки, собранные через конкатенацию/форматирование.

